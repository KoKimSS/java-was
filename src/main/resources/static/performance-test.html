<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I/O ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #results { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px; white-space: pre-wrap; }
        .stats { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 3px; }
        .concurrent-test { margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸš€ I/O ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h3>ë‹¨ì¼ ìš”ì²­ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="performTest('db')">ğŸ“Š Database Test</button>
        <button onclick="performTest('file')">ğŸ“ File I/O Test</button>
        <button onclick="performTest('network')">ğŸŒ Network Test</button>
        <button onclick="performTest('mixed')">ğŸ”„ Mixed Test</button>
        
        <div style="margin-top: 10px;">
            <label>ì§€ì—° ì‹œê°„ (ms): <input type="number" id="delay" value="100" min="0" max="5000"></label>
        </div>
    </div>
    
    <div class="concurrent-test">
        <h3>ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ (NIO ì„±ëŠ¥ í™•ì¸)</h3>
        <label>ë™ì‹œ ìš”ì²­ ìˆ˜: <input type="number" id="concurrentCount" value="10" min="1" max="100"></label>
        <button onclick="performConcurrentTest()">ğŸ”¥ ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸</button>
        <button onclick="performLoadTest()">âš¡ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (50ê°œ ìš”ì²­)</button>
    </div>
    
    <div class="stats" id="stats" style="display: none;">
        <h4>ğŸ“ˆ í†µê³„</h4>
        <div id="statsContent"></div>
    </div>
    
    <div id="results">í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>

    <script>
        let testCount = 0;
        let totalDuration = 0;
        
        async function performTest(type) {
            const delay = document.getElementById('delay').value;
            const startTime = Date.now();
            
            updateResults(`ğŸ”„ ${type.toUpperCase()} í…ŒìŠ¤íŠ¸ ì‹œì‘... (ì§€ì—°: ${delay}ms)`);
            
            try {
                const response = await fetch(`/api/performance-test?type=${type}&delay=${delay}`);
                const result = await response.json();
                const clientDuration = Date.now() - startTime;
                
                testCount++;
                totalDuration += clientDuration;
                
                updateResults(`âœ… ${type.toUpperCase()} í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\n` +
                            `ì„œë²„ ì²˜ë¦¬ ì‹œê°„: ${result.duration}ms\n` +
                            `í´ë¼ì´ì–¸íŠ¸ ì „ì²´ ì‹œê°„: ${clientDuration}ms\n` +
                            `ê²°ê³¼: ${JSON.stringify(result, null, 2)}`);
                
                updateStats();
                
            } catch (error) {
                updateResults(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        async function performConcurrentTest() {
            const count = parseInt(document.getElementById('concurrentCount').value);
            const delay = document.getElementById('delay').value;
            
            updateResults(`ğŸš€ ë™ì‹œ ìš”ì²­ ${count}ê°œ ì‹œì‘...`);
            const startTime = Date.now();
            
            const promises = [];
            for (let i = 0; i < count; i++) {
                promises.push(
                    fetch(`/api/performance-test?type=mixed&delay=${delay}`)
                        .then(r => r.json())
                        .then(result => ({ success: true, duration: result.duration }))
                        .catch(error => ({ success: false, error: error.message }))
                );
            }
            
            try {
                const results = await Promise.all(promises);
                const totalTime = Date.now() - startTime;
                
                const successful = results.filter(r => r.success).length;
                const avgDuration = results
                    .filter(r => r.success)
                    .reduce((sum, r) => sum + r.duration, 0) / successful;
                
                updateResults(`âœ… ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\n` +
                            `ì´ ìš”ì²­: ${count}ê°œ\n` +
                            `ì„±ê³µ: ${successful}ê°œ\n` +
                            `ì‹¤íŒ¨: ${count - successful}ê°œ\n` +
                            `ì „ì²´ ì†Œìš” ì‹œê°„: ${totalTime}ms\n` +
                            `í‰ê·  ì„œë²„ ì²˜ë¦¬ ì‹œê°„: ${avgDuration.toFixed(2)}ms\n` +
                            `ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰: ${(count / (totalTime / 1000)).toFixed(2)} req/sec`);
                
            } catch (error) {
                updateResults(`âŒ ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        async function performLoadTest() {
            updateResults(`âš¡ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œì‘... (50ê°œ ì—°ì† ìš”ì²­)`);
            const startTime = Date.now();
            
            const results = [];
            
            for (let i = 0; i < 50; i++) {
                try {
                    const reqStart = Date.now();
                    const response = await fetch('/api/performance-test?type=db&delay=50');
                    const result = await response.json();
                    const reqTime = Date.now() - reqStart;
                    
                    results.push({
                        request: i + 1,
                        clientTime: reqTime,
                        serverTime: result.duration,
                        success: true
                    });
                    
                    if ((i + 1) % 10 === 0) {
                        updateResults(`ì§„í–‰ì¤‘... ${i + 1}/50 ì™„ë£Œ`);
                    }
                    
                } catch (error) {
                    results.push({
                        request: i + 1,
                        error: error.message,
                        success: false
                    });
                }
            }
            
            const totalTime = Date.now() - startTime;
            const successful = results.filter(r => r.success);
            const avgClientTime = successful.reduce((sum, r) => sum + r.clientTime, 0) / successful.length;
            const avgServerTime = successful.reduce((sum, r) => sum + r.serverTime, 0) / successful.length;
            
            updateResults(`ğŸ¯ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼\n\n` +
                        `ì´ ìš”ì²­: 50ê°œ\n` +
                        `ì„±ê³µ: ${successful.length}ê°œ\n` +
                        `ì „ì²´ ì†Œìš” ì‹œê°„: ${totalTime}ms\n` +
                        `í‰ê·  í´ë¼ì´ì–¸íŠ¸ ì‹œê°„: ${avgClientTime.toFixed(2)}ms\n` +
                        `í‰ê·  ì„œë²„ ì²˜ë¦¬ ì‹œê°„: ${avgServerTime.toFixed(2)}ms\n` +
                        `ì²˜ë¦¬ëŸ‰: ${(50 / (totalTime / 1000)).toFixed(2)} req/sec`);
        }
        
        function updateResults(content) {
            document.getElementById('results').textContent = content;
        }
        
        function updateStats() {
            const avgDuration = (totalDuration / testCount).toFixed(2);
            document.getElementById('statsContent').innerHTML = 
                `ì´ í…ŒìŠ¤íŠ¸: ${testCount}íšŒ<br>` +
                `í‰ê·  ì‘ë‹µ ì‹œê°„: ${avgDuration}ms`;
            document.getElementById('stats').style.display = 'block';
        }
    </script>
</body>
</html>
